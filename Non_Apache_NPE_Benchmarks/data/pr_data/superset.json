[
    {
        "pr": "https://github.com/apache/superset/pull/9139",
        "repo": "superset",
        "number": 9139,
        "bug_id": "superset_9139",
        "title": "Catch TypeError on PyArrow array instantiation",
        "body": "### CATEGORY\r\n\r\nChoose one\r\n\r\n- [x] Bug Fix\r\n- [ ] Enhancement (new features, refinement)\r\n- [ ] Refactor\r\n- [ ] Add tests\r\n- [ ] Build / Development Environment\r\n- [ ] Documentation\r\n\r\n### SUMMARY\r\nThe following (Postgres) query fails with `TypeError: an integer is required (got type str)`:\r\n```\r\nSELECT json_build_object('test', json_build_array(123456, 'test')) AS data;\r\n```\r\nThis is also raised when columnar data from Presto is in the following format (mixed array data types):\r\n```\r\n{'TestKey': [123456, 'foo']}\r\n```\r\n\r\nSee also: https://github.com/apache/incubator-superset/pull/9096#issuecomment-584449351\r\n\r\n*NOTE: this is meant to be a temporary fix until the [Arrow ticket](https://issues.apache.org/jira/browse/ARROW-7855) is resolved.*\r\n\r\n### BEFORE/AFTER SCREENSHOTS OR ANIMATED GIF\r\n<!--- Skip this if not applicable -->\r\n\r\n### TEST PLAN\r\nEnsure the following query against Postgres succeeds:\r\n```\r\nSELECT json_build_object('test', json_build_array(123456, 'test')) AS data;\r\n```\r\n\r\n### ADDITIONAL INFORMATION\r\n<!--- Check any relevant boxes with \"x\" -->\r\n<!--- HINT: Include \"Fixes #nnn\" if you are fixing an existing issue -->\r\n- [ ] Has associated issue:\r\n- [ ] Changes UI\r\n- [ ] Requires DB Migration.\r\n- [ ] Confirm DB Migration upgrade and downgrade tested.\r\n- [ ] Introduces new feature or API\r\n- [ ] Removes existing feature or API\r\n\r\n### REVIEWERS\r\n@john-bodley @serenajiang @nytai @willbarrett @dpgaspar @suddjian ",
        "date": "2020-02-17",
        "merge_hash": "0992445ae907879f2308fb9493e19d62a27911d4",
        "files": [
            {
                "sha": "8c4c56755fa708b983feb9e7d2a7913a3cb7da32",
                "filename": "superset/result_set.py",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/apache/superset/blob/0992445ae907879f2308fb9493e19d62a27911d4/superset/result_set.py",
                "raw_url": "https://github.com/apache/superset/raw/0992445ae907879f2308fb9493e19d62a27911d4/superset/result_set.py",
                "contents_url": "https://api.github.com/repos/apache/superset/contents/superset/result_set.py?ref=0992445ae907879f2308fb9493e19d62a27911d4"
            },
            {
                "sha": "f1d78a4185c1c64b17d34cc5a779e19d93ba5d5c",
                "filename": "tests/result_set_tests.py",
                "status": "modified",
                "additions": 10,
                "deletions": 0,
                "changes": 10,
                "blob_url": "https://github.com/apache/superset/blob/0992445ae907879f2308fb9493e19d62a27911d4/tests/result_set_tests.py",
                "raw_url": "https://github.com/apache/superset/raw/0992445ae907879f2308fb9493e19d62a27911d4/tests/result_set_tests.py",
                "contents_url": "https://api.github.com/repos/apache/superset/contents/tests/result_set_tests.py?ref=0992445ae907879f2308fb9493e19d62a27911d4"
            }
        ]
    },
    {
        "pr": "https://github.com/apache/superset/pull/10300",
        "repo": "superset",
        "number": 10300,
        "bug_id": "superset_10300",
        "title": "fix(chart-data-api): improve chart data endpoint errors",
        "body": "### SUMMARY\r\n\r\nTL;DR: this makes viz plugins behave in the same way as legacy viz plugins when the request fails or returns no data.\r\n\r\nThis fixes the following problems in the chart data endpoint:\r\n- if no data was returned, the chart would not render, leaving the old chart on screen, potentially even an incorrect chart type. This was due to the legacy endpoint returning a 200 with empty data, as opposed to the new endpoint returning a 200 response with an error field but without a data field. To harmonize behavior, `QueryContext` was updated to return a non-error response with an empty data field for empty result sets.\r\n- The `error_message` property of `QueryResult` was not being populated for failed requests in SQLA model, leading to the `error` field on `QueryObject` always being `None`.\r\n- Errors were not picked up from `QueryObject`s when calling the chart data endpoint. This meant that erroneous requests were returned as 200s with an error-field that was not handled in any way, causing the chart to render in unexpected ways. Now the `error` field is is checked for each response dataset; if a single one is defined, a 400 is returned (these are mostly expected to be incorrect SQL).\r\n- The error message from erroneous requests (=incorrect request schema) were not displayed, making it difficult to see in the frontend what the problem was.\r\n\r\n### BEFORE/AFTER SCREENSHOTS OR ANIMATED GIF\r\n\r\n### AFTER\r\nWhen no data is returned, the chart data endpoint returns a response that the `Chart` component can properly identify as an empty response. Previously this left the previous rendered state visible.\r\n![image](https://user-images.githubusercontent.com/33317356/87297393-05c2f480-c511-11ea-95a4-148254a09090.png)\r\n\r\nWhen an incorrect request is performed, the error message is displayed, making debugging easier. Previously only \"An error occurred.\" was displayed (please note that the error in this screenshot has been fixed by #10299).\r\n![image](https://user-images.githubusercontent.com/33317356/87297616-681bf500-c511-11ea-939b-e05f48b2c193.png)\r\n\r\nWhen an a query is incorrect, the error is displayed in the warning (previously this would print \"An error occurred while rendering the visualization: TypeError: Cannot read property 'map' of undefined\") \r\n![image](https://user-images.githubusercontent.com/33317356/87398566-b6d39880-c5be-11ea-9a6c-b728c57e4059.png)\r\n\r\n### TEST PLAN\r\nLocal testing.\r\n\r\n### ADDITIONAL INFORMATION\r\n<!--- Check any relevant boxes with \"x\" -->\r\n<!--- HINT: Include \"Fixes #nnn\" if you are fixing an existing issue -->\r\n- [ ] Has associated issue:\r\n- [ ] Changes UI\r\n- [ ] Requires DB Migration.\r\n- [ ] Confirm DB Migration upgrade and downgrade tested.\r\n- [ ] Introduces new feature or API\r\n- [ ] Removes existing feature or API\r\n",
        "date": "2020-07-14",
        "merge_hash": "c44ee06b5d633a13221ff037065765f936b51b65",
        "files": [
            {
                "sha": "956230446ee6865676f45ecedfbc2fec4c6abecb",
                "filename": "superset-frontend/src/chart/Chart.jsx",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/apache/superset/blob/c44ee06b5d633a13221ff037065765f936b51b65/superset-frontend/src/chart/Chart.jsx",
                "raw_url": "https://github.com/apache/superset/raw/c44ee06b5d633a13221ff037065765f936b51b65/superset-frontend/src/chart/Chart.jsx",
                "contents_url": "https://api.github.com/repos/apache/superset/contents/superset-frontend/src/chart/Chart.jsx?ref=c44ee06b5d633a13221ff037065765f936b51b65"
            },
            {
                "sha": "af359a4dc43a284b070a115911c0310d0441e35e",
                "filename": "superset/charts/api.py",
                "status": "modified",
                "additions": 6,
                "deletions": 3,
                "changes": 9,
                "blob_url": "https://github.com/apache/superset/blob/c44ee06b5d633a13221ff037065765f936b51b65/superset/charts/api.py",
                "raw_url": "https://github.com/apache/superset/raw/c44ee06b5d633a13221ff037065765f936b51b65/superset/charts/api.py",
                "contents_url": "https://api.github.com/repos/apache/superset/contents/superset/charts/api.py?ref=c44ee06b5d633a13221ff037065765f936b51b65"
            },
            {
                "sha": "e602fbfac8f439636ee06b23fbbcb2108311a808",
                "filename": "superset/common/query_context.py",
                "status": "modified",
                "additions": 2,
                "deletions": 6,
                "changes": 8,
                "blob_url": "https://github.com/apache/superset/blob/c44ee06b5d633a13221ff037065765f936b51b65/superset/common/query_context.py",
                "raw_url": "https://github.com/apache/superset/raw/c44ee06b5d633a13221ff037065765f936b51b65/superset/common/query_context.py",
                "contents_url": "https://api.github.com/repos/apache/superset/contents/superset/common/query_context.py?ref=c44ee06b5d633a13221ff037065765f936b51b65"
            },
            {
                "sha": "c73152a28d2018ff8db1d48bc585a1379c3a6492",
                "filename": "superset/connectors/sqla/models.py",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/apache/superset/blob/c44ee06b5d633a13221ff037065765f936b51b65/superset/connectors/sqla/models.py",
                "raw_url": "https://github.com/apache/superset/raw/c44ee06b5d633a13221ff037065765f936b51b65/superset/connectors/sqla/models.py",
                "contents_url": "https://api.github.com/repos/apache/superset/contents/superset/connectors/sqla/models.py?ref=c44ee06b5d633a13221ff037065765f936b51b65"
            },
            {
                "sha": "03a98640c3317b4cd67a8ec89c8b48c3a95f4ca6",
                "filename": "tests/charts/api_tests.py",
                "status": "modified",
                "additions": 52,
                "deletions": 0,
                "changes": 52,
                "blob_url": "https://github.com/apache/superset/blob/c44ee06b5d633a13221ff037065765f936b51b65/tests/charts/api_tests.py",
                "raw_url": "https://github.com/apache/superset/raw/c44ee06b5d633a13221ff037065765f936b51b65/tests/charts/api_tests.py",
                "contents_url": "https://api.github.com/repos/apache/superset/contents/tests/charts/api_tests.py?ref=c44ee06b5d633a13221ff037065765f936b51b65"
            }
        ]
    },
    {
        "pr": "https://github.com/apache/superset/pull/8946",
        "repo": "superset",
        "number": 8946,
        "bug_id": "superset_8946",
        "title": "Ensure proper JSON serialization of numpy.ndarray",
        "body": "### CATEGORY\r\n\r\nChoose one\r\n\r\n- [X] Bug Fix\r\n- [ ] Enhancement (new features, refinement)\r\n- [ ] Refactor\r\n- [ ] Add tests\r\n- [ ] Build / Development Environment\r\n- [ ] Documentation\r\n\r\n### SUMMARY\r\nWhen querying a Presto datasource with a column of type `ARRAY` asynchronously, the following error would be raised: \r\n```\r\nTypeError: Unserializable object [] of type <class 'numpy.ndarray'>\r\n```\r\n\r\nThis fix ensures proper conversion of the `numpy.ndarray` to a list for JSON serialization.\r\n\r\n### BEFORE/AFTER SCREENSHOTS OR ANIMATED GIF\r\n<!--- Skip this if not applicable -->\r\n\r\n### TEST PLAN\r\nEnsure queries against a Presto table containing nested data type columns work correctly. Repeat for other supported DBs having nested data type columns.\r\n\r\nThis fix was tested against Presto 0.227 in both async and sync queries.\r\n\r\n### ADDITIONAL INFORMATION\r\n<!--- Check any relevant boxes with \"x\" -->\r\n<!--- HINT: Include \"Fixes #nnn\" if you are fixing an existing issue -->\r\n- [ ] Has associated issue:\r\n- [ ] Changes UI\r\n- [ ] Requires DB Migration.\r\n- [ ] Confirm DB Migration upgrade and downgrade tested.\r\n- [ ] Introduces new feature or API\r\n- [ ] Removes existing feature or API\r\n\r\n### REVIEWERS\r\n@graceguo-supercat @craig-rueda @dpgaspar @villebro ",
        "date": "2020-01-10",
        "merge_hash": "7ff18f060c32e7559976e6def3b3323e9ef9cf22",
        "files": [
            {
                "sha": "4ba09fa3d833ee3312c453bc57735c5bce344315",
                "filename": "superset/utils/core.py",
                "status": "modified",
                "additions": 5,
                "deletions": 3,
                "changes": 8,
                "blob_url": "https://github.com/apache/superset/blob/7ff18f060c32e7559976e6def3b3323e9ef9cf22/superset/utils/core.py",
                "raw_url": "https://github.com/apache/superset/raw/7ff18f060c32e7559976e6def3b3323e9ef9cf22/superset/utils/core.py",
                "contents_url": "https://api.github.com/repos/apache/superset/contents/superset/utils/core.py?ref=7ff18f060c32e7559976e6def3b3323e9ef9cf22"
            },
            {
                "sha": "5bbfec1b328c03fe5749ab93ad45fe0a863023b6",
                "filename": "tests/utils_tests.py",
                "status": "modified",
                "additions": 1,
                "deletions": 0,
                "changes": 1,
                "blob_url": "https://github.com/apache/superset/blob/7ff18f060c32e7559976e6def3b3323e9ef9cf22/tests/utils_tests.py",
                "raw_url": "https://github.com/apache/superset/raw/7ff18f060c32e7559976e6def3b3323e9ef9cf22/tests/utils_tests.py",
                "contents_url": "https://api.github.com/repos/apache/superset/contents/tests/utils_tests.py?ref=7ff18f060c32e7559976e6def3b3323e9ef9cf22"
            }
        ]
    },
    {
        "pr": "https://github.com/apache/superset/pull/6963",
        "repo": "superset",
        "number": 6963,
        "bug_id": "superset_6963",
        "title": "[sql-parse] Fixing parsing LIMIT exceptions",
        "body": "This PR fixes an issue when trying to extract the `LIMIT` from a query and the `LIMIT` value is either missing or ill-defined which previously would raise a series of exceptions (`IndexError`, `TypeError`, etc.) which would result in an `Internal Server Error` (500) being thrown. \r\n\r\nNote if no valid `LIMIT` can be extracted we simply return `None` and allow the underlying database engine to flag the issue during parsing. \r\n\r\nto: @graceguo-supercat @michellethomas @mistercrunch @timifasubaa",
        "date": "2019-03-05",
        "merge_hash": "3e076cb60b385e675ed1c9a8053493375e43370b",
        "files": [
            {
                "sha": "b653c88a2a0018fefdbd125e2d1a4248b96eca17",
                "filename": "superset/sql_parse.py",
                "status": "modified",
                "additions": 8,
                "deletions": 11,
                "changes": 19,
                "blob_url": "https://github.com/apache/superset/blob/3e076cb60b385e675ed1c9a8053493375e43370b/superset/sql_parse.py",
                "raw_url": "https://github.com/apache/superset/raw/3e076cb60b385e675ed1c9a8053493375e43370b/superset/sql_parse.py",
                "contents_url": "https://api.github.com/repos/apache/superset/contents/superset/sql_parse.py?ref=3e076cb60b385e675ed1c9a8053493375e43370b"
            },
            {
                "sha": "1390f5092a45ce53acc306ab9729c1889f232041",
                "filename": "tests/db_engine_specs_test.py",
                "status": "modified",
                "additions": 14,
                "deletions": 0,
                "changes": 14,
                "blob_url": "https://github.com/apache/superset/blob/3e076cb60b385e675ed1c9a8053493375e43370b/tests/db_engine_specs_test.py",
                "raw_url": "https://github.com/apache/superset/raw/3e076cb60b385e675ed1c9a8053493375e43370b/tests/db_engine_specs_test.py",
                "contents_url": "https://api.github.com/repos/apache/superset/contents/tests/db_engine_specs_test.py?ref=3e076cb60b385e675ed1c9a8053493375e43370b"
            }
        ]
    }
]