[
    {
        "pr": "https://github.com/pallets/click/pull/1805",
        "repo": "click",
        "number": 1805,
        "bug_id": "click_1805",
        "title": "Better error message for bad parameter default",
        "body": "Added a `try` block to check whether the default value provided to an option with `multiple=True` is a valid iterable. If the value is not a valid iterable, a `TypeError` with a better error message is raised.\r\n\r\n- fixes #1749 \r\n\r\nChecklist:\r\n\r\n- [x] Add tests that demonstrate the correct behavior of the change. Tests should fail without the change.\r\n- [x] Add or update relevant docs, in the docs folder and in code.\r\n- [x] Add an entry in `CHANGES.rst` summarizing the change and linking to the issue.\r\n- [x] Add `.. versionchanged::` entries in any relevant code docs.\r\n- [x] Run `pre-commit` hooks and fix any issues.\r\n- [x] Run `pytest` and `tox`, no tests failed.\r\n",
        "date": "2021-03-05",
        "merge_hash": "1cb86096124299579156f2c983efe05585f1a01b",
        "files": [
            {
                "sha": "ac11bf3134b65e9182f8036492ae4c1350448430",
                "filename": "CHANGES.rst",
                "status": "modified",
                "additions": 2,
                "deletions": 0,
                "changes": 2,
                "blob_url": "https://github.com/pallets/click/blob/1cb86096124299579156f2c983efe05585f1a01b/CHANGES.rst",
                "raw_url": "https://github.com/pallets/click/raw/1cb86096124299579156f2c983efe05585f1a01b/CHANGES.rst",
                "contents_url": "https://api.github.com/repos/pallets/click/contents/CHANGES.rst?ref=1cb86096124299579156f2c983efe05585f1a01b"
            },
            {
                "sha": "f3192c5e31bd2db7e6e33b6f29232eda48c47519",
                "filename": "src/click/core.py",
                "status": "modified",
                "additions": 9,
                "deletions": 1,
                "changes": 10,
                "blob_url": "https://github.com/pallets/click/blob/1cb86096124299579156f2c983efe05585f1a01b/src/click/core.py",
                "raw_url": "https://github.com/pallets/click/raw/1cb86096124299579156f2c983efe05585f1a01b/src/click/core.py",
                "contents_url": "https://api.github.com/repos/pallets/click/contents/src/click/core.py?ref=1cb86096124299579156f2c983efe05585f1a01b"
            },
            {
                "sha": "65109d69a40b499009a1601e15de24573e1ef5ea",
                "filename": "tests/test_options.py",
                "status": "modified",
                "additions": 14,
                "deletions": 0,
                "changes": 14,
                "blob_url": "https://github.com/pallets/click/blob/1cb86096124299579156f2c983efe05585f1a01b/tests/test_options.py",
                "raw_url": "https://github.com/pallets/click/raw/1cb86096124299579156f2c983efe05585f1a01b/tests/test_options.py",
                "contents_url": "https://api.github.com/repos/pallets/click/contents/tests/test_options.py?ref=1cb86096124299579156f2c983efe05585f1a01b"
            }
        ]
    },
    {
        "pr": "https://github.com/pallets/click/pull/1852",
        "repo": "click",
        "number": 1852,
        "bug_id": "click_1852",
        "title": "refactor type_cast_value",
        "body": "* Don't need recursion to validate `mutliple` and `nargs`.\r\n* When validating value at runtime, only raise `BadParameter`, not `TypeError` or `ValueError`.\r\n* Validate `default` value against `multiple` and `nargs` in `__init__`. Can't use `type_cast_value` on `default` as that can have side effects such as opening a file.\r\n* For `multiple` and `nargs=-1`, validate that the value is iterable (and not a string). For `nargs>0` validate that the length matches. For `multiple` and `nargs>0`, validate the length of each item.\r\n* Reword error messages for consistency.\r\n* Reword error message about \"arity\" since that's a technical term. For `types.Tuple.convert`, raise a `BadParameter` error and match the argument count error that Python would raise.\r\n* For ease of validation, needed to make `multiple` a parameter for `Parameter` instead of only `Option`. `Argument` checks that it's not given.\r\n\r\n<!--\r\nLink to relevant issues or previous PRs, one per line. Use \"fixes\" to\r\nautomatically close an issue.\r\n-->\r\n\r\n- fixes #1806 \r\n\r\n<!--\r\nEnsure each step in CONTRIBUTING.rst is complete by adding an \"x\" to\r\neach box below.\r\n\r\nIf only docs were changed, these aren't relevant and can be removed.\r\n-->\r\n\r\nChecklist:\r\n\r\n- [x] Add tests that demonstrate the correct behavior of the change. Tests should fail without the change.\r\n- [x] Add or update relevant docs, in the docs folder and in code.\r\n- [x] Add an entry in `CHANGES.rst` summarizing the change and linking to the issue.\r\n- [x] Add `.. versionchanged::` entries in any relevant code docs.\r\n- [x] Run `pre-commit` hooks and fix any issues.\r\n- [x] Run `pytest` and `tox`, no tests failed.\r\n",
        "date": "2021-04-15",
        "merge_hash": "cef43dec86d22413d13573f6c58a45565dbe2861",
        "files": [
            {
                "sha": "51f47dc3fbe7f215ed538cfd95c2631374cda97a",
                "filename": "CHANGES.rst",
                "status": "modified",
                "additions": 3,
                "deletions": 0,
                "changes": 3,
                "blob_url": "https://github.com/pallets/click/blob/cef43dec86d22413d13573f6c58a45565dbe2861/CHANGES.rst",
                "raw_url": "https://github.com/pallets/click/raw/cef43dec86d22413d13573f6c58a45565dbe2861/CHANGES.rst",
                "contents_url": "https://api.github.com/repos/pallets/click/contents/CHANGES.rst?ref=cef43dec86d22413d13573f6c58a45565dbe2861"
            },
            {
                "sha": "14ef872a94b4e0e330317c83093d49a8ab41a12d",
                "filename": "src/click/core.py",
                "status": "modified",
                "additions": 116,
                "deletions": 66,
                "changes": 182,
                "blob_url": "https://github.com/pallets/click/blob/cef43dec86d22413d13573f6c58a45565dbe2861/src/click/core.py",
                "raw_url": "https://github.com/pallets/click/raw/cef43dec86d22413d13573f6c58a45565dbe2861/src/click/core.py",
                "contents_url": "https://api.github.com/repos/pallets/click/contents/src/click/core.py?ref=cef43dec86d22413d13573f6c58a45565dbe2861"
            },
            {
                "sha": "0d210923f044ed661cd98b35b93bce4b6c668bad",
                "filename": "src/click/types.py",
                "status": "modified",
                "additions": 13,
                "deletions": 4,
                "changes": 17,
                "blob_url": "https://github.com/pallets/click/blob/cef43dec86d22413d13573f6c58a45565dbe2861/src/click/types.py",
                "raw_url": "https://github.com/pallets/click/raw/cef43dec86d22413d13573f6c58a45565dbe2861/src/click/types.py",
                "contents_url": "https://api.github.com/repos/pallets/click/contents/src/click/types.py?ref=cef43dec86d22413d13573f6c58a45565dbe2861"
            },
            {
                "sha": "2045f6f9c26ba4034bc6e464ee05d5e03c98a287",
                "filename": "tests/test_arguments.py",
                "status": "modified",
                "additions": 13,
                "deletions": 21,
                "changes": 34,
                "blob_url": "https://github.com/pallets/click/blob/cef43dec86d22413d13573f6c58a45565dbe2861/tests/test_arguments.py",
                "raw_url": "https://github.com/pallets/click/raw/cef43dec86d22413d13573f6c58a45565dbe2861/tests/test_arguments.py",
                "contents_url": "https://api.github.com/repos/pallets/click/contents/tests/test_arguments.py?ref=cef43dec86d22413d13573f6c58a45565dbe2861"
            },
            {
                "sha": "94e5eb8d75ca73589841645221d9ab8d9479ffe4",
                "filename": "tests/test_options.py",
                "status": "modified",
                "additions": 33,
                "deletions": 12,
                "changes": 45,
                "blob_url": "https://github.com/pallets/click/blob/cef43dec86d22413d13573f6c58a45565dbe2861/tests/test_options.py",
                "raw_url": "https://github.com/pallets/click/raw/cef43dec86d22413d13573f6c58a45565dbe2861/tests/test_options.py",
                "contents_url": "https://api.github.com/repos/pallets/click/contents/tests/test_options.py?ref=cef43dec86d22413d13573f6c58a45565dbe2861"
            }
        ]
    },
    {
        "pr": "https://github.com/pallets/click/pull/1551",
        "repo": "click",
        "number": 1551,
        "bug_id": "click_1551",
        "title": "Fix behavior when setting options_metavar parameter as empty ",
        "body": "Hi,\r\n\r\nI have encountered an issue when using a Command object without any options.\r\nAs I wanted to prevent the '[OPTION]' from appearing in the Usage line, I tried to set the options_metavar parameter to None but got an exception.\r\n\r\nI also tried to set it as an empty string rather than None, there's no exception then but the behavior isn't perfect neither as it prints a double space in the Usage row (the double space is between the filename and the argument)\r\n\r\nHere's a code snippet to reproduce the issue with None\r\n\r\n```python\r\n@click.command(\"foo\", options_metavar=None)\r\n@click.argument(\"bar\")\r\ndef cli():\r\n    pass\r\n```\r\n\r\n### Expected Behavior\r\nRunning the above, I expected to see\r\n```bash\r\n$ python foobar.py --help\r\nUsage: foobar.py BAR\r\n\r\nOptions:\r\n  --help  Show this message and exit.\r\n```\r\n\r\n### Actual Behavior\r\nAn error is raised as the formatter was expecting a string instead of a None.\r\n\r\n```pytb\r\nTraceback (most recent call last):\r\n  File \"foobar.py\", line 8, in <module>\r\n    cli()\r\n  File \"/home/romain/projects/apps/myprss/.venv/lib/python3.7/site-packages/click/core.py\", line 829, in __call__\r\n    return self.main(*args, **kwargs)\r\n  File \"/home/romain/projects/apps/myprss/.venv/lib/python3.7/site-packages/click/core.py\", line 781, in main\r\n    with self.make_context(prog_name, args, **extra) as ctx:\r\n  File \"/home/romain/projects/apps/myprss/.venv/lib/python3.7/site-packages/click/core.py\", line 700, in make_context\r\n    self.parse_args(ctx, args)\r\n  File \"/home/romain/projects/apps/myprss/.venv/lib/python3.7/site-packages/click/core.py\", line 1048, in parse_args\r\n    value, args = param.handle_parse_result(ctx, opts, args)\r\n  File \"/home/romain/projects/apps/myprss/.venv/lib/python3.7/site-packages/click/core.py\", line 1630, in handle_parse_result\r\n    value = invoke_param_callback(self.callback, ctx, self, value)\r\n  File \"/home/romain/projects/apps/myprss/.venv/lib/python3.7/site-packages/click/core.py\", line 123, in invoke_param_callback\r\n    return callback(ctx, param, value)\r\n  File \"/home/romain/projects/apps/myprss/.venv/lib/python3.7/site-packages/click/core.py\", line 950, in show_help\r\n    echo(ctx.get_help(), color=ctx.color)\r\n  File \"/home/romain/projects/apps/myprss/.venv/lib/python3.7/site-packages/click/core.py\", line 570, in get_help\r\n    return self.command.get_help(self)\r\n  File \"/home/romain/projects/apps/myprss/.venv/lib/python3.7/site-packages/click/core.py\", line 975, in get_help\r\n    self.format_help(ctx, formatter)\r\n  File \"/home/romain/projects/apps/myprss/.venv/lib/python3.7/site-packages/click/core.py\", line 1001, in format_help\r\n    self.format_usage(ctx, formatter)\r\n  File \"/home/romain/projects/apps/myprss/.venv/lib/python3.7/site-packages/click/core.py\", line 923, in format_usage\r\n    formatter.write_usage(ctx.command_path, \" \".join(pieces))\r\nTypeError: sequence item 0: expected str instance, NoneType found\r\n```\r\n\r\n### Environment\r\n\r\n* Python version: 3.7.4\r\n* Click version: 7.1.2\r\n",
        "date": "2020-10-13",
        "merge_hash": "4aabded1badf94b1de8bb939f11cbebcdd94a22e",
        "files": [
            {
                "sha": "03d1cf941e2410a2a381d25140b9fb37931a374d",
                "filename": "CHANGES.rst",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/pallets/click/blob/4aabded1badf94b1de8bb939f11cbebcdd94a22e/CHANGES.rst",
                "raw_url": "https://github.com/pallets/click/raw/4aabded1badf94b1de8bb939f11cbebcdd94a22e/CHANGES.rst",
                "contents_url": "https://api.github.com/repos/pallets/click/contents/CHANGES.rst?ref=4aabded1badf94b1de8bb939f11cbebcdd94a22e"
            },
            {
                "sha": "227025dc000a05e47ff63f6469a24eca766842e2",
                "filename": "src/click/core.py",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "blob_url": "https://github.com/pallets/click/blob/4aabded1badf94b1de8bb939f11cbebcdd94a22e/src/click/core.py",
                "raw_url": "https://github.com/pallets/click/raw/4aabded1badf94b1de8bb939f11cbebcdd94a22e/src/click/core.py",
                "contents_url": "https://api.github.com/repos/pallets/click/contents/src/click/core.py?ref=4aabded1badf94b1de8bb939f11cbebcdd94a22e"
            },
            {
                "sha": "f292c16713390f27bcf99336041f94a41a8d88ab",
                "filename": "tests/test_formatting.py",
                "status": "modified",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "blob_url": "https://github.com/pallets/click/blob/4aabded1badf94b1de8bb939f11cbebcdd94a22e/tests/test_formatting.py",
                "raw_url": "https://github.com/pallets/click/raw/4aabded1badf94b1de8bb939f11cbebcdd94a22e/tests/test_formatting.py",
                "contents_url": "https://api.github.com/repos/pallets/click/contents/tests/test_formatting.py?ref=4aabded1badf94b1de8bb939f11cbebcdd94a22e"
            }
        ]
    }
]